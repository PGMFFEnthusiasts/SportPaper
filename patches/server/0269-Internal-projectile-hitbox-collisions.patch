From ce58fca7fe1796e5f252b66d7de32a686f775dff Mon Sep 17 00:00:00 2001
From: ThatApplePieGuy <necrozma999@gmail.com>
Date: Mon, 26 Jan 2026 18:03:34 -0700
Subject: [PATCH] Internal projectile hitbox collisions


diff --git a/src/main/java/net/minecraft/server/EntityProjectile.java b/src/main/java/net/minecraft/server/EntityProjectile.java
index 049aad638..dd35ee083 100644
--- a/src/main/java/net/minecraft/server/EntityProjectile.java
+++ b/src/main/java/net/minecraft/server/EntityProjectile.java
@@ -121,6 +121,7 @@ public abstract class EntityProjectile extends Entity implements IProjectile {
 
         if (!this.world.isClientSide) {
             Entity entity = null;
+            List<Entity> inside = new java.util.ArrayList<>(); // SportPaper
             List list = this.world.getEntities(this, this.getBoundingBox().a(this.motX, this.motY, this.motZ).grow(1.0D, 1.0D, 1.0D));
             double d0 = 0.0D;
             EntityLiving entityliving = this.getShooter();
@@ -140,10 +141,32 @@ public abstract class EntityProjectile extends Entity implements IProjectile {
                             entity = entity1;
                             d0 = d1;
                         }
+                    // SportPaper start - Check inside hitbox
+                    } else if (axisalignedbb.a(vec3d)) {
+                        inside.add(entity1);
+                    // SportPaper end
                     }
                 }
             }
 
+            // SportPaper start - Choose inside entity that should collide first
+            if (!inside.isEmpty()) {
+                Entity closest = null;
+                double minDistanceSq = Double.MAX_VALUE;
+
+                for (Entity testEntity : inside) {
+                    double distanceSq = vec3d.distanceSquared(new Vec3D(testEntity.locX, testEntity.locY, testEntity.locZ));
+                    if (distanceSq < minDistanceSq) {
+                        minDistanceSq = distanceSq;
+                        closest = testEntity;
+                    }
+                }
+
+                if (closest != null) {
+                    entity = closest;
+                }
+            }
+            // SportPaper end
             if (entity != null) {
                 movingobjectposition = new MovingObjectPosition(entity);
             }
-- 
2.52.0

